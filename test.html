<script src="jquery.js" type="text/javascript"></script>

<style>
    #facade:hover{
        color: #fff;
    }
    #facade {
        transition: all 0.5s ease;
        position: absolute;
        padding: 50px; 
        top: 0px; left: 0px;width: 120px;
        background-color: transparent; 
        opacity: 0.6; 
        
    }
</style>

<div style="">
    <div style="">
        Shimmer in Canvas
    </div>

    <div style="position:relative; margin: 40px; padding: 40px; width: 240px;">
        <div style="position: absolute; padding: 50px 30px 10px 30px; border: 1px solid #ccc; background-image:url('shimmer.jpg'); ">
            <canvas id="shimmer" height="150" width="250"></canvas>
        </div>
    </div>
</div>



<script>

    // requestAnim shim layer by Paul Irish
    window.requestAnimFrame = (function(){
      return  window.requestAnimationFrame       || 
              window.webkitRequestAnimationFrame || 
              window.mozRequestAnimationFrame    || 
              window.oRequestAnimationFrame      || 
              window.msRequestAnimationFrame     || 
              function(/* function */ callback, /* DOMElement */ element){
                window.setTimeout(callback, 1000 / 60);
              };
    })();
    var shimmer = (function shimmer(){
        var canvas = document.getElementById("shimmer");
        var ctx = canvas.getContext('2d');
        ctx.font = "20pt Arial";
        var lightSource = 0, 
            lightLeft, 
            lightCenter, 
            lightRight, 
            spread = 0.28, 
            correctedInc;
        return {
            currTime: Date.now(),
            diffTime: 0,
            spread: 0,
            paused: false,
            pausedTime: 0,
            pauseInterval: 850,
            lightSource: 0,
            inc: 0.032,
            lightSpread: 0.45,
            animations: ['slide','slide','slide','glow'],
            currentAnimationIndex: 0,
            keepTime: function(){
                this.diffTime = Date.now() - this.currTime;
                this.currTime = Date.now();
            },
            cycleAnimation: function(){
                this.currentAnimationIndex+=1;
                if(this.currentAnimationIndex >= this.animations.length){
                    this.currentAnimationIndex = 0;
                } 
            },
            animate: function(){
                var currentAnimation = this.animations[this.currentAnimationIndex];
                if(currentAnimation === 'glow'){
                    return this.animateGlow(); // return glow style
                } else if (currentAnimation === 'slide'){
                    return this.animateSlide(); // return slide gradient
                } else {
                    console.log("unknown animation type: "+String(currentAnimation));
                }
            },
            animateGlow: function(){
                console.log('glow!');
                var glowEnd = 255; 
                var r = g = b = 68;
                return function(){
                    console.log("glow inner");    
                    return "rgb("+ r + "," + r + "," + r + ")";
                }
            }(),
            animateSlide: function(){
                
                var gradient = ctx.createLinearGradient(0,0,240,0),
                    smartInc = this.inc * (this.diffTime/(1000/60)),
                    lightLeft,
                    lightRight,
                    lightCenter;
                    
                if(this.paused){
                    if((Date.now()-this.pausedTime) > this.pauseInterval){
                        this.paused = false;
                        this.lightSource = -0.3; 
                        this.lightCycle = 0;
                    }
                } else {
                    this.lightSource += smartInc;
                    if(this.lightSource > (1+this.lightSpread)){ 
                        this.paused = true;
                        this.pausedTime = Date.now();
                        this.cycleAnimation()
                    }
                }
                // lighting positions:
                lightCenter = (this.lightSource > 1) ? 1 : this.lightSource;
                if (lightCenter < 0) lightCenter = 0;
                lightLeft = ((this.lightSource - this.lightSpread) < 0) ? 0 : this.lightSource - this.lightSpread;
                if (lightLeft > 1) lightLeft = 1;
                lightRight = (this.lightSource + this.lightSpread) > 1 ? 1 : this.lightSource + this.lightSpread; 
                if (lightRight < 0) lightRight = 0;
                
                gradient.addColorStop(lightLeft,"#444");
                gradient.addColorStop(lightCenter,"#ffffff");
                gradient.addColorStop(lightRight,"#444");

                return gradient;
            },
            on: function(){

                this.keepTime();

                ctx.clearRect(0,0,240,120);
                ctx.fillStyle = this.animate();  
                ctx.fillText("Shimmer", 10, 20);
                ctx.fillText(this.currTime, 10, 45);
                ctx.fillText(this.diffTime, 175, 75);
            }
        }
    }())

    function animate() {
        requestAnimFrame( animate );
        shimmer.on();
    };

    animate();

</script>
